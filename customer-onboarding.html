<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>üìù My Portal - Client Registration</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="shared-styles.css">
    <style>
        /* Customer Onboarding - Mobile-First Design */
        
        body {
            background: var(--very-light-gray);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
            background: var(--white);
            min-height: 100vh;
        }

        /* Navigation Header */
        .nav-header {
            background: var(--white);
            border-bottom: 1px solid var(--border-color);
            padding: var(--spacing-2) 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 100%;
            margin: 0 auto;
            padding: 0 var(--spacing-4);
        }

        .nav-logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--primary-red);
            font-weight: 700;
        }

        .nav-logo i {
            font-size: 1.5rem;
        }

        .nav-menu {
            display: flex;
            gap: var(--spacing-3);
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 500;
            padding: var(--spacing-1) var(--spacing-2);
            border-radius: var(--border-radius);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--spacing-1);
            font-size: var(--font-size-sm);
        }

        .nav-link:hover {
            background: var(--light-gray);
            color: var(--primary-red);
        }

        .nav-link.active {
            background: var(--primary-red);
            color: var(--white);
        }

        .nav-link i {
            font-size: 0.9rem;
        }

        /* Mobile Navigation */
        .nav-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-primary);
            cursor: pointer;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-menu {
                position: fixed;
                top: 50px;
                left: -100%;
                width: 100%;
                height: calc(100vh - 50px);
                background: var(--white);
                flex-direction: column;
                padding: var(--spacing-4);
                transition: left 0.3s ease;
                box-shadow: 2px 0 8px rgba(0,0,0,0.1);
                z-index: 99;
            }

            .nav-menu.active {
                left: 0;
            }

            .nav-link {
                width: 100%;
                justify-content: flex-start;
                padding: var(--spacing-3);
                border-radius: var(--border-radius);
                margin-bottom: var(--spacing-1);
                font-size: var(--font-size-base);
            }

            .nav-toggle {
                display: block;
            }

            .header h1 {
                font-size: 2rem;
            }

            .header p {
                font-size: var(--font-size-base);
            }
        }

        @media (max-width: 480px) {
            .nav-header {
                padding: var(--spacing-3) var(--spacing-4);
            }

            .header {
                padding: var(--spacing-6) var(--spacing-4);
            }

            .header h1 {
                font-size: 1.75rem;
            }
        }

        /* Header Section */
        .header {
            background: var(--gradient-primary);
            color: var(--white);
            padding: var(--spacing-8) var(--spacing-6);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="90" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100%" height="100%" fill="url(%23grain)"/></svg>');
            pointer-events: none;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: var(--spacing-4);
            line-height: 1.1;
        }

        .header p {
            font-size: var(--font-size-lg);
            margin-bottom: 0;
            opacity: 0.9;
        }

        /* Progress Bar */
        .progress-container {
            background: var(--white);
            padding: var(--spacing-6) var(--spacing-4);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-3);
            position: relative;
        }

        .progress-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--border-color);
            z-index: 1;
            transform: translateY(-50%);
        }

        .progress-line-active {
            height: 3px;
            background: var(--primary-red);
            transition: width 0.5s ease;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
        }

        .step {
            background: var(--white);
            border: 3px solid var(--border-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: var(--font-size-lg);
            z-index: 3;
            position: relative;
            transition: all 0.3s ease;
        }

        .step.active {
            background: var(--primary-red);
            border-color: var(--primary-red);
            color: var(--white);
            transform: scale(1.1);
        }

        .step.completed {
            background: var(--success);
            border-color: var(--success);
            color: var(--white);
        }

        .step-labels {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--medium-gray);
        }

        .step-label {
            text-align: center;
            flex: 1;
            padding: 0 var(--spacing-2);
        }

        .step-label.active {
            color: var(--primary-red);
            font-weight: 700;
        }

        /* Form Sections */
        .form-section {
            display: none;
            padding: var(--spacing-6) var(--spacing-4);
            background: var(--white);
        }

        .form-section.active {
            display: block;
        }

        .section-title {
            font-size: var(--font-size-2xl);
            font-weight: 800;
            color: var(--dark-gray);
            margin-bottom: var(--spacing-6);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-3);
        }

        .section-title i {
            font-size: 3rem;
            color: var(--primary-red);
            background: var(--very-light-gray);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Company Selector */
        .company-selector {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-4);
            margin-bottom: var(--spacing-8);
        }

        .company-option {
            background: var(--white);
            border: 3px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-6);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            box-shadow: var(--shadow-sm);
        }

        .company-option:hover {
            border-color: var(--primary-red);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .company-option.selected {
            border-color: var(--primary-red);
            background: rgba(220, 38, 38, 0.05);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .company-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .company-icon {
            font-size: 3rem;
            color: var(--primary-red);
            margin-bottom: var(--spacing-3);
        }

        .company-name {
            font-weight: 800;
            font-size: var(--font-size-xl);
            color: var(--dark-gray);
            margin-bottom: var(--spacing-2);
        }

        .company-desc {
            font-size: var(--font-size-base);
            color: var(--medium-gray);
            line-height: 1.5;
        }

        /* Form Groups */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-5);
            margin-bottom: var(--spacing-6);
        }

        .form-group {
            margin-bottom: var(--spacing-4);
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            font-weight: 700;
            color: var(--dark-gray);
            margin-bottom: var(--spacing-2);
            font-size: var(--font-size-base);
        }

        .form-group label.required::after {
            content: ' *';
            color: var(--primary-red);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: var(--spacing-4);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-base);
            font-family: inherit;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Help Text */
        .help-text {
            font-size: var(--font-size-sm);
            color: var(--medium-gray);
            margin-top: var(--spacing-1);
            line-height: 1.4;
        }

        /* Form Navigation */
        .form-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-6) var(--spacing-4);
            background: var(--white);
            border-top: 1px solid var(--border-color);
            position: sticky;
            bottom: 0;
            z-index: 10;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
        }

        .btn {
            padding: var(--spacing-4) var(--spacing-6);
            border: none;
            border-radius: var(--radius-lg);
            font-size: var(--font-size-base);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
            text-decoration: none;
            min-height: 50px;
        }

        .btn-primary {
            background: var(--primary-red);
            color: var(--white);
        }

        .btn-primary:hover {
            background: #b91c1c;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--medium-gray);
            color: var(--white);
        }

        .btn-secondary:hover {
            background: var(--dark-gray);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Messages */
        .message {
            padding: var(--spacing-4);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-4);
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
            font-weight: 600;
        }

        .message.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .message.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fed7aa;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-content {
            background: var(--white);
            padding: var(--spacing-8);
            border-radius: var(--radius-xl);
            text-align: center;
            max-width: 300px;
            margin: var(--spacing-4);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--spacing-4);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Auto-save indicator */
        .auto-save {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: var(--white);
            padding: var(--spacing-3) var(--spacing-4);
            border-radius: 25px;
            font-size: var(--font-size-sm);
            font-weight: 600;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
        }

        .auto-save.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* Confirmation Section */
        .confirmation-data {
            background: var(--very-light-gray);
            border-radius: var(--radius-lg);
            padding: var(--spacing-6);
            margin-bottom: var(--spacing-6);
        }

        .confirmation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-3) 0;
            border-bottom: 1px solid var(--border-color);
        }

        .confirmation-item:last-child {
            border-bottom: none;
        }

        .confirmation-label {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .confirmation-value {
            color: var(--medium-gray);
            text-align: right;
            max-width: 60%;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .header p {
                font-size: var(--font-size-base);
            }

            .step {
                width: 45px;
                height: 45px;
                font-size: var(--font-size-base);
            }

            .section-title {
                font-size: var(--font-size-xl);
            }

            .section-title i {
                width: 60px;
                height: 60px;
                font-size: 2rem;
            }

            .company-icon {
                font-size: 2.5rem;
            }

            .company-name {
                font-size: var(--font-size-lg);
            }

            .btn {
                padding: var(--spacing-3) var(--spacing-4);
                font-size: var(--font-size-sm);
            }
        }

        /* Large screens */
        @media (min-width: 768px) {
            .container {
                max-width: 800px;
                margin: 0 auto;
                box-shadow: var(--shadow-xl);
            }

            .company-selector {
                grid-template-columns: 1fr 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr 1fr;
            }

            .form-group.full-width {
                grid-column: 1 / -1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation Header -->
        <nav class="nav-header">
            <div class="nav-container">
                <a href="business-portal.html" class="nav-logo">
                    <i class="fas fa-fire"></i>
                </a>
                <div class="nav-menu">
                    <a href="business-portal.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="dashboard-clientes.html" class="nav-link">
                        <i class="fas fa-users"></i>
                        <span>Clients</span>
                    </a>
                    <a href="fire_escapes_rp.html" class="nav-link">
                        <i class="fas fa-file-alt"></i>
                        <span>Reports</span>
                    </a>
                    <a href="customer-onboarding.html" class="nav-link active">
                        <i class="fas fa-user-plus"></i>
                        <span>Registration</span>
                    </a>
                    <a href="system-config.html" class="nav-link">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </div>
                <button class="nav-toggle" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </nav>

        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <h1>üìù New Client Registration</h1>
                <p>Complete this form to register a new client in our system</p>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-line">
                    <div class="progress-line-active" id="progressLine"></div>
                </div>
                <div class="step active" id="step1">1</div>
                <div class="step" id="step2">2</div>
                <div class="step" id="step3">3</div>
                <div class="step" id="step4">4</div>
            </div>
            <div class="step-labels">
                <div class="step-label active">Company & Service</div>
                <div class="step-label">Client Info</div>
                <div class="step-label">Project Details</div>
                <div class="step-label">Confirmation</div>
            </div>
        </div>

        <!-- Messages -->
        <div class="message success" id="successMessage" style="display: none;">
            <i class="fas fa-check-circle"></i>
            Client registered successfully
        </div>

        <div class="message error" id="errorMessage" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            Error registering client
        </div>

        <div class="message warning" id="warningMessage" style="display: none;">
            <i class="fas fa-exclamation-circle"></i>
            Warning
        </div>

        <!-- Form -->
        <form id="onboardingForm">
            <!-- Step 1: Company & Service -->
            <div class="form-section active" id="section1">
                <h3 class="section-title">
                    <i class="fas fa-building"></i>
                    Select Company and Service
                </h3>

                <div class="company-selector">
                    <label class="company-option" for="company-boston" style="cursor: pointer;">
                        <input type="radio" id="company-boston" name="companyName" value="Boston Fire Escapes" required>
                        <div class="company-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="company-name">Boston Fire Escapes</div>
                        <div class="company-desc">Fire escape inspections and services</div>
                    </label>

                    <label class="company-option" for="company-irias" style="cursor: pointer;">
                        <input type="radio" id="company-irias" name="companyName" value="Irias Iron Works" required>
                        <div class="company-icon">
                            <i class="fas fa-hammer"></i>
                        </div>
                        <div class="company-name">Irias Iron Works</div>
                        <div class="company-desc">General ironwork and metalwork jobs</div>
                    </label>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="serviceType" class="required">Service Type</label>
                        <select id="serviceType" name="serviceType" required>
                            <option value="">Select service...</option>
                            <!-- Services will be loaded dynamically based on company selection -->
                        </select>
                        <div class="help-text">Choose the type of service you need</div>
                    </div>

                    <div class="form-group">
                        <label for="urgencyLevel">Urgency Level</label>
                        <select id="urgencyLevel" name="urgencyLevel">
                            <option value="Low">Low - Routine</option>
                            <option value="Medium" selected>Medium - Standard</option>
                            <option value="High">High - Urgent</option>
                            <option value="Emergency">Emergency - Immediate</option>
                        </select>
                        <div class="help-text">How urgent is this service?</div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Client Information -->
            <div class="form-section" id="section2">
                <h3 class="section-title">
                    <i class="fas fa-user"></i>
                    Client Information
                </h3>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="clientFullName" class="required">Full Name</label>
                        <input type="text" id="clientFullName" name="clientFullName" required placeholder="John Smith">
                        <div class="help-text">Enter the client's full name</div>
                    </div>

                    <div class="form-group">
                        <label for="email" class="required">Email Address</label>
                        <input type="email" id="email" name="email" required placeholder="john.smith@email.com">
                        <div class="help-text">We'll send confirmation to this email</div>
                    </div>

                    <div class="form-group">
                        <label for="customerPhoneNumber" class="required">Phone Number</label>
                        <input type="tel" id="customerPhoneNumber" name="customerPhoneNumber" required placeholder="(555) 123-4567">
                        <div class="help-text">Primary contact number</div>
                    </div>

                    <div class="form-group full-width">
                        <label for="address" class="required">Project Address</label>
                        <input type="text" id="address" name="address" required placeholder="123 Main Street, Boston, MA 02101">
                        <div class="help-text">Full address where the service will be performed</div>
                    </div>

                    <div class="form-group">
                        <label for="customerType" class="required">Property Type</label>
                        <select id="customerType" name="customerType" required>
                            <option value="">Select property type...</option>
                            <option value="Residential">Residential</option>
                            <option value="Commercial">Commercial</option>
                        </select>
                        <div class="help-text">This helps us organize your project correctly</div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Project Details -->
            <div class="form-section" id="section3">
                <h3 class="section-title">
                    <i class="fas fa-tools"></i>
                    Project Details
                </h3>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="serviceRequested" class="required">Service Requested</label>
                        <input type="text" id="serviceRequested" name="serviceRequested" required placeholder="Fire escape inspection and repair">
                        <div class="help-text">Brief description of what you need</div>
                    </div>

                    <div class="form-group">
                        <label for="price">Estimated Price ($)</label>
                        <input type="number" id="price" name="price" step="0.01" placeholder="1500">
                        <div class="help-text">Estimated cost (optional)</div>
                    </div>

                    <div class="form-group full-width">
                        <label for="technicalDescription" class="required">Detailed Description</label>
                        <textarea id="technicalDescription" name="technicalDescription" required placeholder="Please describe the work needed in detail..."></textarea>
                        <div class="help-text">Provide as much detail as possible about the work needed</div>
                    </div>

                    <div class="form-group full-width">
                        <label for="additionalNotes">Additional Notes</label>
                        <textarea id="additionalNotes" name="additionalNotes" placeholder="Any additional information, special requirements, or notes..."></textarea>
                        <div class="help-text">Any other important information we should know</div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Confirmation -->
            <div class="form-section" id="section4">
                <h3 class="section-title">
                    <i class="fas fa-check-circle"></i>
                    Confirm Registration
                </h3>

                <div class="confirmation-data" id="confirmationData">
                    <!-- Data will be populated by JavaScript -->
                </div>

                <div class="message warning">
                    <i class="fas fa-info-circle"></i>
                    By confirming, your data will be automatically synchronized with our system and you will receive an email confirmation.
                </div>

                <label style="display: flex; align-items: flex-start; gap: var(--spacing-3); margin-bottom: var(--spacing-4); cursor: pointer;">
                    <input type="checkbox" id="termsAccepted" required style="width: 20px; height: 20px; margin: 0; margin-top: 2px; min-width: 20px; min-height: 20px;">
                    <span style="color: var(--dark-gray); line-height: 1.5;">
                        I agree that my data may be used to coordinate the requested service and I understand this information will be stored securely.
                    </span>
                </label>
            </div>

            <!-- Navigation -->
            <div class="form-navigation">
                <button type="button" class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">
                    <i class="fas fa-arrow-left"></i>
                    Previous
                </button>
                <div></div> <!-- Spacer -->
                <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                    Next
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button type="submit" class="btn btn-primary" id="submitBtn" style="display: none;">
                    <i class="fas fa-check"></i>
                    Register Client
                </button>
            </div>
        </form>
    </div>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p><strong>Registering client...</strong></p>
            <p>Synchronizing with Google Sheets</p>
        </div>
    </div>

    <!-- Auto-save indicator -->
    <div class="auto-save" id="autoSave">
        <i class="fas fa-save"></i>
        Draft saved
    </div>

    <script>
        // Customer Onboarding Manager
        class CustomerOnboardingManager {
            constructor() {
                this.currentStep = 1;
                this.totalSteps = 4;
                this.formData = {};
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadFormDraft();
                this.updateProgress();
                
                // Set minimum date to today (if date field exists)
                const dateField = document.getElementById('date');
                if (dateField) {
                    const today = new Date().toISOString().split('T')[0];
                    dateField.min = today;
                }
            }

            setupEventListeners() {
                // Company selection - simplified
                document.querySelectorAll('input[name="companyName"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        console.log('üîÑ Radio change event:', e.target.value);
                        
                        // Update visual selection
                        document.querySelectorAll('.company-option').forEach(option => {
                            option.classList.remove('selected');
                        });
                        e.target.closest('.company-option').classList.add('selected');
                        
                        // Update services for the selected company
                        if (typeof window.updateServicesForCompany === 'function') {
                            window.updateServicesForCompany(e.target.value);
                        }
                        
                        this.saveFormDraft();
                    });
                });

                // Form validation on input
                document.querySelectorAll('input, select, textarea').forEach(input => {
                    input.addEventListener('input', () => {
                        this.validateCurrentStep();
                        this.saveFormDraft();
                    });
                    input.addEventListener('blur', (e) => this.validateField(e.target));
                });

                // Phone formatting
                document.getElementById('customerPhoneNumber').addEventListener('input', (e) => {
                    e.target.value = this.formatPhone(e.target.value);
                });

                // Form submission
                document.getElementById('onboardingForm').addEventListener('submit', (e) => this.handleSubmit(e));

                // Auto-save every 30 seconds
                setInterval(() => this.saveFormDraft(), 30000);
            }

            formatPhone(value) {
                // Remove all non-digits
                const phone = value.replace(/\D/g, '');
                
                // Format as (XXX) XXX-XXXX
                if (phone.length >= 6) {
                    return `(${phone.slice(0, 3)}) ${phone.slice(3, 6)}-${phone.slice(6, 10)}`;
                } else if (phone.length >= 3) {
                    return `(${phone.slice(0, 3)}) ${phone.slice(3)}`;
                }
                return phone;
            }

            nextStep() {
                if (!this.validateCurrentStep()) {
                    this.showMessage('Please complete all required fields before continuing.', 'warning');
                    return;
                }

                if (this.currentStep < this.totalSteps) {
                    this.currentStep++;
                    this.updateStepDisplay();
                    this.updateProgress();

                    if (this.currentStep === this.totalSteps) {
                        this.populateConfirmation();
                    }
                }
            }

            previousStep() {
                if (this.currentStep > 1) {
                    this.currentStep--;
                    this.updateStepDisplay();
                    this.updateProgress();
                }
            }

            updateStepDisplay() {
                // Hide all sections
                document.querySelectorAll('.form-section').forEach(section => {
                    section.classList.remove('active');
                });

                // Show current section
                document.getElementById(`section${this.currentStep}`).classList.add('active');

                // Update step indicators
                document.querySelectorAll('.step').forEach((step, index) => {
                    step.classList.remove('active', 'completed');
                    if (index + 1 < this.currentStep) {
                        step.classList.add('completed');
                        step.innerHTML = '<i class="fas fa-check"></i>';
                    } else if (index + 1 === this.currentStep) {
                        step.classList.add('active');
                        step.textContent = index + 1;
                    } else {
                        step.textContent = index + 1;
                    }
                });

                // Update step labels
                document.querySelectorAll('.step-label').forEach((label, index) => {
                    label.classList.remove('active');
                    if (index + 1 === this.currentStep) {
                        label.classList.add('active');
                    }
                });

                // Update navigation buttons
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                const submitBtn = document.getElementById('submitBtn');

                prevBtn.style.display = this.currentStep > 1 ? 'flex' : 'none';
                nextBtn.style.display = this.currentStep < this.totalSteps ? 'flex' : 'none';
                submitBtn.style.display = this.currentStep === this.totalSteps ? 'flex' : 'none';
            }

            updateProgress() {
                const progress = ((this.currentStep - 1) / (this.totalSteps - 1)) * 100;
                document.getElementById('progressLine').style.width = `${progress}%`;
            }

            validateCurrentStep() {
                const currentSection = document.getElementById(`section${this.currentStep}`);
                const requiredFields = currentSection.querySelectorAll('[required]');
                let isValid = true;

                requiredFields.forEach(field => {
                    if (!this.validateField(field)) {
                        isValid = false;
                    }
                });

                return isValid;
            }

            validateField(field) {
                const value = field.value.trim();
                const isValid = value !== '' && field.checkValidity();
                
                if (isValid) {
                    field.style.borderColor = 'var(--success)';
                } else {
                    field.style.borderColor = 'var(--primary-red)';
                }
                
                return isValid;
            }

            populateConfirmation() {
                const formData = new FormData(document.getElementById('onboardingForm'));
                const data = {};
                
                for (let [key, value] of formData.entries()) {
                    data[key] = value;
                }

                const confirmationData = document.getElementById('confirmationData');
                confirmationData.innerHTML = '';

                const fields = [
                    { label: 'Company', key: 'companyName' },
                    { label: 'Service Type', key: 'serviceType' },
                    { label: 'Client Name', key: 'clientFullName' },
                    { label: 'Email', key: 'email' },
                    { label: 'Phone', key: 'customerPhoneNumber' },
                    { label: 'Address', key: 'address' },
                    { label: 'Property Type', key: 'customerType' },
                    { label: 'Service Requested', key: 'serviceRequested' },
                    { label: 'Urgency', key: 'urgencyLevel' },
                    { label: 'Price', key: 'price' }
                ];

                fields.forEach(field => {
                    if (data[field.key]) {
                        const item = document.createElement('div');
                        item.className = 'confirmation-item';
                        item.innerHTML = `
                            <span class="confirmation-label">${field.label}:</span>
                            <span class="confirmation-value">${data[field.key]}</span>
                        `;
                        confirmationData.appendChild(item);
                    }
                });
            }

            async handleSubmit(e) {
                e.preventDefault();

                if (!document.getElementById('termsAccepted').checked) {
                    this.showMessage('Please accept the terms and conditions.', 'warning');
                    return;
                }

                const formData = new FormData(e.target);
                const data = {};
                
                for (let [key, value] of formData.entries()) {
                    data[key] = value;
                }

                // Add default values for Google Sheets
                data.formEmailerStatus = 'Pending';
                data.clientId = this.generateClientId();
                data.invoiceStatus = 'Pending';
                data.estimateStatus = 'Pending';
                data.customerStatus = data.customerStatus || 'New Lead'; // Use form value or default
                data.responsable = 'David Ramirez';
                data.timestamp = new Date().toISOString();
                data.date = new Date().toLocaleDateString();
                data.correo = data.email;

                try {
                    this.showLoading(true);
                    this.showMessage('Registering client in Google Sheets...', 'info');

                    // Step 1: Register client in Google Sheets
                    const response = await fetch('/api/clients', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (!result.success) {
                        throw new Error(result.message || 'Failed to register client in Google Sheets');
                    }

                    this.showMessage('‚úÖ Client registered successfully! Processing notifications...', 'info');

                    // Check if email and Zoho were processed
                    if (result.emailSent) {
                        this.showMessage('‚úÖ Email notification sent successfully!', 'info');
                    } else if (result.emailError) {
                        console.warn('‚ö†Ô∏è Email notification failed:', result.emailError);
                        this.showMessage('‚ö†Ô∏è Email notification failed, but continuing...', 'warning');
                    }

                    if (result.zohoTriggered) {
                        this.showMessage('‚úÖ Zoho Flow triggered successfully!', 'info');
                    } else if (result.zohoError) {
                        console.warn('‚ö†Ô∏è Zoho Flow failed:', result.zohoError);
                        this.showMessage('‚ö†Ô∏è Zoho Flow failed, but client was registered successfully', 'warning');
                    }

                    // Final success message
                    this.showMessage('üéâ Client registration completed successfully!', 'success');
                    this.clearFormDraft();
                    
                    setTimeout(() => {
                        window.location.href = '/dashboard-clientes.html';
                    }, 3000);
                    
                } catch (error) {
                    console.error('Error registering client:', error);
                    this.showMessage(`Error: ${error.message}`, 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            generateClientId() {
                const timestamp = Date.now().toString().slice(-6);
                const random = Math.random().toString(36).substr(2, 3).toUpperCase();
                return `CLI${timestamp}${random}`;
            }

            showLoading(show) {
                document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
            }

            showMessage(message, type) {
                // Create or find message element
                let messageElement = document.getElementById(`${type}Message`);
                
                if (!messageElement) {
                    // Create message element if it doesn't exist
                    messageElement = document.createElement('div');
                    messageElement.id = `${type}Message`;
                    messageElement.className = `message ${type}`;
                    
                    // Add icon based on type
                    const icon = type === 'success' ? 'check-circle' : 
                                type === 'error' ? 'exclamation-triangle' : 
                                type === 'warning' ? 'exclamation-circle' : 'info-circle';
                    
                    messageElement.innerHTML = `<i class="fas fa-${icon}"></i>`;
                    
                    // Insert at the top of the form
                    const form = document.getElementById('onboardingForm');
                    form.parentNode.insertBefore(messageElement, form);
                }
                
                // Update message content (preserve icon)
                const icon = messageElement.querySelector('i');
                messageElement.innerHTML = '';
                if (icon) messageElement.appendChild(icon);
                messageElement.appendChild(document.createTextNode(message));
                
                messageElement.style.display = 'block';
                
                setTimeout(() => {
                    messageElement.style.display = 'none';
                }, 5000);
            }

            saveFormDraft() {
                const formData = new FormData(document.getElementById('onboardingForm'));
                const data = {};
                
                for (let [key, value] of formData.entries()) {
                    data[key] = value;
                }
                
                localStorage.setItem('onboardingDraft', JSON.stringify(data));
                this.showAutoSave();
            }

            loadFormDraft() {
                const draft = localStorage.getItem('onboardingDraft');
                if (draft) {
                    const data = JSON.parse(draft);
                    Object.keys(data).forEach(key => {
                        const field = document.querySelector(`[name="${key}"]`);
                        if (field) {
                            field.value = data[key];
                        }
                    });
                }
            }

            clearFormDraft() {
                localStorage.removeItem('onboardingDraft');
            }

            showAutoSave() {
                const autoSave = document.getElementById('autoSave');
                autoSave.classList.add('show');
                setTimeout(() => {
                    autoSave.classList.remove('show');
                }, 2000);
            }
        }

        // Company services configuration
        const companyServices = {
            'Boston Fire Escapes': [
                'Fire Escape Inspection',
                'Fire Escape Repair',
                'Fire Escape Maintenance',
                'Emergency Fire Escape Service',
                'Fire Escape Certification',
                'Fire Escape Testing',
                'Fire Escape Compliance Check'
            ],
            'Irias Iron Works': [
                'Iron Works General',
                'Railings',
                'Gates',
                'Stairs',
                'Fences',
                'Metal Fabrication',
                'Welding Services',
                'Custom Iron Work',
                'Structural Iron Work',
                'Decorative Iron Work'
            ]
        };

        // Initialize when page loads
        let onboardingManager;
        window.addEventListener('load', () => {
            console.log('üöÄ Page loaded, initializing...');
            onboardingManager = new CustomerOnboardingManager();
            
            // Initialize with default company if none selected
            const selectedCompany = document.querySelector('input[name="companyName"]:checked');
            if (selectedCompany) {
                console.log('üîÑ Initial company selected:', selectedCompany.value);
                if (typeof window.updateServicesForCompany === 'function') {
                    window.updateServicesForCompany(selectedCompany.value);
                }
            } else {
                console.log('üìã No company pre-selected');
            }
            
            console.log('‚úÖ Initialization completed');
            
            // Add simple click handlers for company options
            document.querySelectorAll('.company-option').forEach(option => {
                option.addEventListener('click', function() {
                    const radio = this.querySelector('input[type="radio"]');
                    if (radio) {
                        radio.checked = true;
                        radio.dispatchEvent(new Event('change', { bubbles: true }));
                    }
                });
            });
        });

        // Function to update services based on company selection
        window.updateServicesForCompany = function(companyName) {
            console.log('üîÑ updateServicesForCompany called with:', companyName);
            
            const serviceSelect = document.getElementById('serviceType');
            if (!serviceSelect) {
                console.error('‚ùå Service select element not found');
                return;
            }
            
            console.log('üìã Service select found:', serviceSelect);
            
            const services = companyServices[companyName] || [];
            console.log('üìã Available services for', companyName, ':', services);
            
            // Clear existing options
            const currentOptions = serviceSelect.options.length;
            console.log('üóëÔ∏è Clearing', currentOptions, 'existing options');
            serviceSelect.innerHTML = '<option value="">Select service...</option>';
            
            // Add new options
            services.forEach((service, index) => {
                const option = document.createElement('option');
                option.value = service;
                option.textContent = service;
                serviceSelect.appendChild(option);
                console.log(`‚ûï Added option ${index + 1}:`, service);
            });
            
            console.log(`‚úÖ Services updated for ${companyName}:`, services);
            console.log('üìä Total options in select:', serviceSelect.options.length);
            
            // Verify the change
            const newOptions = Array.from(serviceSelect.options).map(opt => opt.textContent);
            console.log('üîç Final options in select:', newOptions);
            
            // Verify the selected company is correct
            const selectedRadio = document.querySelector('input[name="companyName"]:checked');
            if (selectedRadio) {
                console.log('üîç Currently selected company:', selectedRadio.value);
                if (selectedRadio.value !== companyName) {
                    console.warn('‚ö†Ô∏è Mismatch: Expected', companyName, 'but selected', selectedRadio.value);
                }
            }
            
            // Force a visual update
            serviceSelect.style.display = 'none';
            setTimeout(() => {
                serviceSelect.style.display = '';
            }, 10);
        }

        // Global functions for HTML buttons
        window.nextStep = () => onboardingManager.nextStep();
        window.previousStep = () => onboardingManager.previousStep();

        // Mobile menu toggle
        function toggleMobileMenu() {
            const navMenu = document.querySelector('.nav-menu');
            navMenu.classList.toggle('active');
        }
    </script>
</body>
</html> 